import React, { useRef, useEffect } from "react";
import styled from "styled-components";

const VideoContainer = styled.div`
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  background-color: #000;
  z-index: -1;
`;

const Video = styled.video`
  width: 100%;
  height: 100%;
  object-fit: cover;
`;

const ScrollContainer = styled.div`
  height: 180vh; /* Adjust the height to be 10 times the height of the video for smooth scrolling */
  overflow-y: scroll;
`;

const BlueBackground = styled.div`
  height: 100vh;
  width: 100vw;
  background-color: blue;
`;

const App = () => {
  const videoRef = useRef(null);

  useEffect(() => {
    const video = videoRef.current;

 let scrollTimeout; // Added variable to hold timeout ID

const handleScroll = () => {
  const video = videoRef.current;
  if (!video) return;

  const videoRect = video.getBoundingClientRect();
  const videoHeight = videoRect.height;
  const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;

  const progress = scrollPosition / videoHeight;

  if (isFinite(progress) && progress < 1) {
    if (isFinite(video.duration)) {
      video.currentTime = progress * video.duration;
      video.play();
    }
  } else {
    // Clear previous timeout if exists
    clearTimeout(scrollTimeout);
    // Set timeout to call video.pause() after 300ms (adjust the value as needed)
    scrollTimeout = setTimeout(() => {
      video.pause();
    }, 300);
  }
};



    window.addEventListener("scroll", handleScroll);
    return () => {
      window.removeEventListener("scroll", handleScroll);
    };
  }, []);

  return (
    <>
      <ScrollContainer>
        {/* Add enough content to the ScrollContainer to enable scrolling */}
        <div style={{ height: "200vh" }}>
          {/* Add video to the top of the content */}
          <VideoContainer>
            <Video ref={videoRef} muted>
              {/* Set the source of the video */}
              <source src={require("./assets/BackGround_Video.mp4")} type="video/mp4" />
            </Video>
          </VideoContainer>
        </div>
      </ScrollContainer>
      <BlueBackground />
    </>
  );
};

export default App;
